---
title: "QuantMod"
author: "Nguyễn Đức Minh Tân"
date: "2024-04-01"
output: html_document
---

# 1. Cài đặt các gói cần thiết

```{r}
install.packages("quantmod")
install.packages("TTR")
```

# 2. Sử dụng thư viện

```{r}
library(TTR)
library(quantmod)
```

# 3. Downloading data

```{r}
getSymbols("NKE", from='2000-01-01',to='2024-04-01')
```

## 3.1 Extract Columns

```{r}
Open <- Op(NKE)   #Open Price
High <- Hi(NKE)    # High price
Low <- Lo(NKE)  # Low price
Close<- Cl(NKE)   #Close Price
Volume <- Vo(NKE)   #Volume
AdjClose <- Ad(NKE) # Adjusted close
```

## 3.2 Sum Of Columns

```{r}
WeekVoYa<- apply.weekly(Vo(NKE),sum)
MonthVoYa <- apply.monthly(Vo(NKE),sum)
QuarterVoYa <- apply.quarterly(Vo(NKE),sum)
YearVoYa <- apply.yearly(Vo(NKE),sum)
```

# 4.Technical Indicators

## 4.1 SMA (Simple Moving Average)

```{r}
sma <-SMA(Cl(NKE),n=20)
tail(sma,n=5)
```

## 4.2 EMA (Exponential Moving Average)

```{r}
ema <-EMA(Cl(NKE),n=20)
tail(ema,n=5)
```

## 4.3 Bollinger band

```{r}
bb <-BBands(Cl(NKE),s.d=2)
tail(bb,n=5)
```

## 4.4 Momentum

```{r}
M <- momentum(Cl(NKE), n=2)
head (M,n=5)
```

## 4.5 ROC

```{r}
ROC <- ROC(Cl(NKE),n=2)
# 2-day ROC
head(ROC,n=5)
```

## 4.6 MACD

```{r}
macd <- MACD(Cl(NKE), nFast=12, nSlow=26,
             nSig=9, maType=SMA)
tail(macd,n=5)
```

## 4.7 RSI

```{r}
rsi = RSI(Cl(NKE), n=14)
tail(rsi,n=5)
```

## Buying Signal

```{r}
price <- Cl(NKE) 
r <- price/Lag(price) - 1 
delta <-0.005 
signal <-c(0) 

#Loop over all trading days (except the first)
for (i in 2: length(price)){
  if (r[i] > delta){
    signal[i]<- 1
  } else
    signal[i]<- 0
}

# Each data is not attached with time
head(signal, n=3)

# Assign time to action variable using reclass;
signal<-reclass(signal,price)

# Each point is now attached with time
tail(signal, n=3)
```

# 5. Chart of Nike

```{r pressure, echo=FALSE}
chartSeries(NKE,
            type="line",
            subset='2007',
            theme=chartTheme('white'))
```

```{r pressure, echo=FALSE}
chartSeries(NKE,
            type="bar",
            subset='2007-05::2007-06',
            theme=chartTheme('white'))
```

```{r pressure, echo=FALSE}
chartSeries(NKE,
            type="candlesticks",
            subset='2007-05',
            theme=chartTheme('white'))
```

```{r pressure, echo=FALSE}
chartSeries(NKE,
            type="auto",
            subset='2007-05-10::2007-05-30',
            theme=chartTheme('white'))
```

## 5.1 Charting SMA

```{r}
chartSeries(NKE,
            subset='2007-05::2009-01',
            theme=chartTheme('white'))
```

## 5.2 Charting EMA

```{r}
chartSeries(NKE,
            subset='2007-05::2009-01',
            theme=chartTheme('white'))
```

## 5.3 Charting Bollinger band

```{r}
chartSeries(NKE,
            subset='2007-05::2009-01',
            theme=chartTheme('white'))
```

## 5.4 Charting Momentum

```{r}
chartSeries(NKE,
            subset='2007-05::2009-01',
            theme=chartTheme('white'))
```

## 5.5 Charting ROC

```{r}
chartSeries(NKE,
            subset='2007-05::2008-01',
            theme=chartTheme('white'))
```

## 5.6 Charting MACD

```{r}
chartSeries(NKE,
            subset='2007-05::2008-01',
            theme=chartTheme('white'))
```

## 5.7 Charting RSI

```{r}
chartSeries(NKE,
            subset='2007-05::2009-01',
            theme=chartTheme('white'))
```

## 5.8 Charting Custom TA

```{r}
sma <- SMA(Cl(NKE),n=14)
chartSeries(NKE,
            subset='2007-05::2009-01',
            theme=chartTheme('white'))
```

## 5.9 Charting Price changes of two stocks

```{r}
stocklist <- c("NKE","GOOG","MSFT")
getSymbols(stocklist)

NS <- function(xdat) xdat / coredata(xdat)[1]
a <- NS(Cl(NKE))-1
g <- NS(Cl(GOOG))-1
m <- NS(Cl(MSFT))-1
chartSeries(a,
            subset = '2007',
            theme=chartTheme('white'))
addTA(g, on=1, col="red", lty="dotted")
addTA(m, on=1, col="blue", lty="dashed")
```

# 6. Performance Evaluation

```{r}
install.packages("PerformanceAnalytics")
library(PerformanceAnalytics)

```

# 7. Evaluating Trading Rules

## 7.1 Simple filter Buy

```{r}
price <- Cl(NKE) # close price
r <- price/Lag(price) - 1 # % price change
delta <-0.005 #threshold
signal <-c(0) # first date has no signal

#Loop over all trading days (except the first)
for (i in 2: length(price)){
  if (r[i] > delta){
    signal[i]<- 1
  } else
    signal[i]<- 0
}
# Each data is not attached with time
head(signal, n=3)
## [1] 0 0 0
# Assign time to action variable using reclass;
signal<-reclass(signal,price)

# Each point is now attached with time
tail(signal, n=3)
# Charting with Trading rule
chartSeries(NKE,
            type = 'line',
            subset="2009-08::2009-09-15",
            theme=chartTheme('white'))
addTA(signal,type='S',col='red')
```

```{r}
trade <- Lag(signal,1) # trade based on yesterday signal
```

```{r}
ret<-dailyReturn(NKE)*trade
names(ret)<-"filter"
#Performance Summary
charts.PerformanceSummary(ret, main="Naive Buy Rule")
```

## 7.2 Simple fiter buy-sell

```{r}
library(quantmod)
getSymbols("NKE")
price <- Cl(MSFT)
r <- price/Lag(price) - 1
delta<-0.005
signal <-c(NA) # first signal is NA

for (i in 2: length(Cl(MSFT))){
  if (r[i] > delta){
    signal[i]<- 1
  } else if (r[i]< -delta){
    signal[i]<- -1
  } else
    signal[i]<- 0
}
signal<-reclass(signal,Cl(MSFT))

trade1 <- Lag(signal)
ret1<-dailyReturn(MSFT)*trade1
names(ret1) <- 'Naive'
charts.PerformanceSummary(ret1)
```
