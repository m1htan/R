---
title: "ACB"
author: "Nguyễn Đức Minh Tân"
date: "2024-04-10"
output: html_document
---

## Tải về và cài đặt các thư viện cần thiết

```{r}
# Install packages
install.packages('tidyverse')
```

```{r}
# Run library
library(ggplot2)
library(tidyverse)
```

## Import dữ liệu về cổ phiếu cần phân tích

```{r}
# Xoá toàn bộ data đang lưu trữ trong bộ nhớ
rm(list = ls())
```

```{r}
# Win
# Lấy dữ liệu về cổ phiếu ngân hàng ACB 
ACB <- read.csv('C://Users/Minh Tan/Downloads/ACB_stock.csv')
```

```{r}
# Mac
# Lấy dữ liệu về cổ phiếu ngân hàng ACB 
ACB <- read.csv('/Users/minhtan/Downloads/ACB_stock.csv')
```

## Kiểm tra tập dữ liệu

### Kiểm tra dữ liệu bị thiếu trong tập dữ liệu

```{r}
colSums(is.na(ACB_1))
```

### Giữ lại các cột cần thiết

```{r}
ACB_1 <- subset(ACB, select = c(date, open, high, low, close, nmVolume))
head(ACB_1)
```

## EDA tập dữ liệu

### Kiểm tra tổng quan bộ dữ liệu

```{r}
dim(ACB_1)
```

```{r}
str(ACB_1)
```

```{r}
summary(ACB_1)
summary(ACB_2)
summary(ACB_3)
```

### Kiểm tra dữ liệu trùng lặp

```{r}
# Kiểm tra dữ liệu trùng lặp
n_occur <- data.frame(table(ACB_1$date))
n_occur[n_occur$Freq > 1,]
ACB_1[ACB_1$date %in% n_occur$Var1[n_occur$Freq > 1],]
```

```{r}
# Xoá dữ liệu trùng lặp
ACB_2 <- ACB_1[!duplicated(ACB_1$date), ]
ACB_2
```

### Trực quan hóa dữ liệu các cột bằng biểu đồ

```{r}
# open, close, high, low, nmVolume, nmValue
ggplot(ACB_1, aes(x=open)) + geom_histogram(binwidth = 1) + geom_histogram()
ggplot(ACB_1, aes(x=close)) + geom_histogram(binwidth = 1) + geom_histogram()
ggplot(ACB_1, aes(x=high)) + geom_histogram(binwidth = 1) + geom_histogram()
ggplot(ACB_1, aes(x=low)) + geom_histogram(binwidth = 1) + geom_histogram()
ggplot(ACB_1, aes(x=nmVolume)) + geom_histogram()
```

```{r}
# Tính hệ số tương quan Pearson giữa hai cột open và close
cor(ACB_3$open, ACB_3$close, use = "complete.obs")
ggplot(ACB_3, aes(x=open, y=close)) + geom_point()

# Tính hệ số tương quan Pearson giữa hai cột open và high
cor(ACB_3$open, ACB_3$high, use = "complete.obs")
ggplot(ACB_3, aes(x=open, y=high)) + geom_point()

# Tính hệ số tương quan Pearson giữa hai cột open và low
cor(ACB_3$open, ACB_3$low, use = "complete.obs")
ggplot(ACB_3, aes(x=open, y=low)) + geom_point()

# Tính hệ số tương quan Pearson giữa hai cột high và close
cor(ACB_3$high, ACB_3$close, use = "complete.obs")
ggplot(ACB_3, aes(x=high, y=close)) + geom_point()

# Tính hệ số tương quan Pearson giữa hai cột low và close
cor(ACB_3$low, ACB_3$close, use = "complete.obs")
ggplot(ACB_3, aes(x=low, y=close)) + geom_point()

# Tính hệ số tương quan Pearson giữa hai cột high và low
cor(ACB_3$high, ACB_3$low, use = "complete.obs")
ggplot(ACB_3, aes(x=high, y=low)) + geom_point()
```

### Xác định và loại bỏ các giá trị outlier

```{r}
# Boxplot trước khi xóa outlier

boxplot(ACB_2$open, ACB_2$close, ACB_2$high, ACB_2$low,
        main = "Boxplot of 'open', 'high', 'low', and 'close' Columns",
        names = c("open", "high", "low", "close"),
        ylab = "Price", xlab = "Columns",
        col = c("blue", "red", "green", "orange"))
boxplot(ACB_2$nmVolume, main="Boxplot of 'nmVolume' Column", ylab="Trading volume")
```

```{r}
# Xác định giá trị outlier trong data frame
outlier_values_nmVolume <- boxplot.stats(ACB_2$nmVolume)$out 

# Xác định vị trí các outlier trong data frame.
id_nmVolume<- which(ACB_2$nmVolume %in% outlier_values_nmVolume)

id <- unique(c(id_nmVolume))
id
# Xoá Outlier
ACB_3 <- ACB_2[-id,]
```

```{r}
# Kiểm tra lại bằng Boxplot

boxplot(ACB_3$open, ACB_3$close, ACB_3$high, ACB_3$low,
        main = "Boxplot of 'open', 'high', 'low', and 'close' Columns",
        names = c("open", "high", "low", "close"),
        ylab = "Price", xlab = "Columns",
        col = c("blue", "red", "green", "orange"))
boxplot(ACB_3$nmVolume, main="Boxplot of 'nmVolume' Column", ylab="Trading volume")
```

```{r}
# Kiểm tra lại bằng Histogram

ggplot(ACB_3, aes(x=open)) + geom_histogram(binwidth = 1) + geom_histogram()
ggplot(ACB_3, aes(x=close)) + geom_histogram(binwidth = 1) + geom_histogram()
ggplot(ACB_3, aes(x=high)) + geom_histogram(binwidth = 1) + geom_histogram()
ggplot(ACB_3, aes(x=low)) + geom_histogram(binwidth = 1) + geom_histogram()
ggplot(ACB_3, aes(x=nmVolume)) + geom_histogram()
```

### Chuyển định dạng dữ liệu cột date

```{r}
ACB_3$date <- as.Date(ACB_3$date)
summary(ACB_3)
```

## Vẽ biểu đồ

```{r}
# Giá mở cửa qua từng năm
ggplot(ACB_3, aes(x = date, y = open)) +
  geom_line() +
  ggtitle("Opening Price Over Time") +
  xlab("Date") +
  ylab("Open Price")

# Giá đóng cửa qua từng năm
ggplot(ACB_3, aes(x = date, y = close)) +
  geom_line() +
  ggtitle("Closing Price Over Time") +
  xlab("Date") +
  ylab("Close Price")

# Khối lượng giao dịch qua từng năm
ggplot(ACB_3, aes(x = date, y = nmVolume)) +
  geom_line() +
  ggtitle("Volume Over Time") +
  xlab("Date") +
  ylab("nmVolume")

# Giá giao dịch cao nhất qua từng năm
ggplot(ACB_3, aes(x = date, y = high)) +
  geom_line() +
  ggtitle("High Price Over Time") +
  xlab("Date") +
  ylab("High")

# Giá giao dịch thấp nhất qua từng năm
ggplot(ACB_3, aes(x = date, y = low)) +
  geom_line() +
  ggtitle("Low Price Over Time") +
  xlab("Date") +
  ylab("Low")
```

\##########################################################################################

# **Phương pháp phân tích**

## Technical analysis with Quantmod

### Install thư viện 

```{r}
install.packages("quantmod")
install.packages("TTR")
```

### Khởi chạy các thư viện cần thiết

```{r}
library(quantmod)
library(xts)
library(TTR)
```

### Vẽ biểu đồ

```{r}
# Chuyển đổi cột 'Date' sang kiểu dữ liệu ngày tháng của R
ACB_3$date <- as.Date(ACB_3$date)

# Chuyển đổi dữ liệu sang đối tượng xts, sử dụng cột 'Date' làm chỉ số
ACB_4 <- xts(ACB_3[, -which(names(ACB_3) == "date")], order.by = ACB_3$date)
```

```{r}
chartSeries(ACB_4, type="line", subset="2013::2023", theme=chartTheme("white"))
```
